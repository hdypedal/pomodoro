<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pomodoro</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;1,9..144,300&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0f1a10;
    --surface: #152016;
    --accent: #63a967;
    --accent2: #2a4a2c;
    --gold: #a8d4aa;
    --text: #e8f0e8;
    --muted: #7a997c;
    --break: #4ecdc4;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .bg-pattern {
    position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(99,169,103,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(78,205,196,0.06) 0%, transparent 50%);
  }

  .container {
    position: relative; z-index: 1;
    width: 420px;
    padding: 40px 36px;
    background: rgba(22, 33, 62, 0.8);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 24px;
    backdrop-filter: blur(20px);
    box-shadow: 0 32px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(99,169,103,0.1);
  }

  .header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 32px;
  }

  .logo {
    font-family: 'Fraunces', serif;
    font-size: 1.1rem;
    font-style: italic;
    color: var(--accent);
    letter-spacing: 0.02em;
  }

  .mode-badge {
    font-size: 0.7rem;
    padding: 4px 10px;
    border-radius: 20px;
    background: rgba(99,169,103,0.15);
    color: var(--accent);
    border: 1px solid rgba(99,169,103,0.3);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: all 0.4s ease;
  }
  .mode-badge.break-mode {
    background: rgba(78,205,196,0.15);
    color: var(--break);
    border-color: rgba(78,205,196,0.3);
  }

  /* Timer ring */
  .timer-wrap {
    position: relative;
    width: 240px; height: 240px;
    margin: 0 auto 28px;
  }

  .timer-svg {
    transform: rotate(-90deg);
    width: 240px; height: 240px;
  }

  .ring-bg {
    fill: none;
    stroke: rgba(255,255,255,0.05);
    stroke-width: 6;
  }

  .ring-progress {
    fill: none;
    stroke: var(--accent);
    stroke-width: 6;
    stroke-linecap: round;
    stroke-dasharray: 691;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 1s linear, stroke 0.4s ease;
    filter: drop-shadow(0 0 8px var(--accent));
    stroke: var(--break);
    filter: drop-shadow(0 0 8px var(--break));
  }

  .timer-display {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 4px;
  }

  .time-text {
    font-family: 'Fraunces', serif;
    font-size: 3.8rem;
    font-weight: 300;
    letter-spacing: -0.02em;
    line-height: 1;
    color: var(--text);
  }

  .time-label {
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  /* Duration selector */
  .duration-section {
    margin-bottom: 24px;
  }

  .section-label {
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .duration-grid {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .dur-btn {
    flex: 1;
    min-width: 52px;
    padding: 8px 4px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }

  .dur-btn:hover {
    background: rgba(99,169,103,0.1);
    border-color: rgba(99,169,103,0.3);
    color: var(--accent);
  }

  .dur-btn.active {
    background: rgba(99,169,103,0.18);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: 0 0 12px rgba(99,169,103,0.2);
  }

  /* Controls */
  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .btn-primary {
    flex: 1;
    padding: 14px;
    background: var(--accent);
    border: none;
    border-radius: 12px;
    color: white;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
  }

  .btn-primary:hover {
    background: #7dc481;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(99,169,103,0.4);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-primary.break-btn {
    background: var(--break);
    box-shadow: none;
  }
  .btn-primary.break-btn:hover {
    background: #6eddd6;
    box-shadow: 0 8px 24px rgba(78,205,196,0.4);
  }

  .btn-secondary {
    padding: 14px 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover {
    background: rgba(255,255,255,0.08);
    color: var(--text);
  }

  /* Tip box */
  .tip-box {
    padding: 14px 16px;
    background: rgba(99,169,103,0.08);
    border: 1px solid rgba(99,169,103,0.25);
    border-radius: 12px;
    font-size: 0.75rem;
    color: var(--gold);
    line-height: 1.6;
    display: none;
    animation: slideIn 0.4s ease;
  }

  .tip-box.visible { display: block; }

  .tip-title {
    font-weight: 500;
    letter-spacing: 0.05em;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Pulse animation when running */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .pulsing .time-text { animation: pulse 2s ease-in-out infinite; }

  /* Done state */
  @keyframes ringDone {
    0%, 100% { transform: rotate(-90deg) scale(1); }
    50% { transform: rotate(-90deg) scale(1.05); }
  }
  .ring-done { animation: ringDone 0.6s ease 3; }
</style>
</head>
<body>

<div class="bg-pattern"></div>

<div class="container">
  <div class="header">
    <div class="logo">pomodoro</div>
    <div class="mode-badge" id="modeBadge">Fokus</div>
  </div>

  <div class="timer-wrap">
    <svg class="timer-svg" viewBox="0 0 240 240">
      <circle class="ring-bg" cx="120" cy="120" r="110"/>
      <circle class="ring-progress" id="ringProgress" cx="120" cy="120" r="110"/>
    </svg>
    <div class="timer-display" id="timerDisplay">
      <div class="time-text" id="timeText">25:00</div>
      <div class="time-label" id="timeLabel">minutter igjen</div>
    </div>
  </div>

  <div class="duration-section" id="durationSection">
    <div class="section-label">Varighet</div>
    <div class="duration-grid" id="durationGrid"></div>
  </div>

  <div class="controls">
    <button class="btn-primary" id="mainBtn" onclick="handleMain()">Start</button>
    <button class="btn-secondary" id="resetBtn" onclick="handleReset()">‚Ü∫</button>
  </div>

  <div class="tip-box" id="tipBox">
    <div class="tip-title">‚òÄÔ∏è Tid for skjermfri pause!</div>
    <div id="tipText"></div>
  </div>
</div>

<script>
const DURATIONS = [25, 30, 35, 40, 45, 50, 55, 60];
const BREAK_DURATION = 5;
const CIRCUMFERENCE = 2 * Math.PI * 110; // ~691

const TIPS = [
  "G√• en liten tur, se ut av vinduet eller strekk p√• deg. La √∏ynene hvile fra skjermen ‚Äì de takker deg for det!",
  "Reis deg opp, beveg kroppen og pust med magen. Hjernen jobber bedre etter en kort, analog pause.",
  "Drikk et glass vann og se p√• noe langt unna. Ingen scrolling ‚Äì bare ro i fem minutter.",
  "Lukk √∏ynene et √∏yeblikk eller se ut p√• himmelen. En skjermfri pause gir hjernen tid til √• bearbeide det du har l√¶rt.",
  "Strekk nakke og skuldre. Det er ingen Instagram som venter ‚Äì bare deg og pausens stillhet."
];

let selectedDuration = 25;
let totalSeconds = 25 * 60;
let remainingSeconds = totalSeconds;
let isRunning = false;
let isBreak = false;
let interval = null;
let tipIndex = 0;

const ring = document.getElementById('ringProgress');
const timeText = document.getElementById('timeText');
const timeLabel = document.getElementById('timeLabel');
const mainBtn = document.getElementById('mainBtn');
const modeBadge = document.getElementById('modeBadge');
const tipBox = document.getElementById('tipBox');
const tipTextEl = document.getElementById('tipText');
const durationSection = document.getElementById('durationSection');
const timerDisplay = document.getElementById('timerDisplay');

ring.style.strokeDasharray = CIRCUMFERENCE;

// Build duration buttons
const grid = document.getElementById('durationGrid');
DURATIONS.forEach(d => {
  const btn = document.createElement('button');
  btn.className = 'dur-btn' + (d === 25 ? ' active' : '');
  btn.textContent = d + ' min';
  btn.dataset.val = d;
  btn.onclick = () => {
    if (isRunning || isBreak) return;
    document.querySelectorAll('.dur-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedDuration = d;
    totalSeconds = d * 60;
    remainingSeconds = totalSeconds;
    updateDisplay();
    updateRing(1);
  };
  grid.appendChild(btn);
});

function updateDisplay() {
  const m = Math.floor(remainingSeconds / 60);
  const s = remainingSeconds % 60;
  timeText.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateRing(fraction) {
  const offset = CIRCUMFERENCE * (1 - fraction);
  ring.style.strokeDashoffset = offset;
}

function playDone() {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const notes = isBreak ? [523, 659, 784] : [784, 659, 523, 440];
    notes.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain); gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = 'sine';
      gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.2);
      gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + i * 0.2 + 0.05);
      gain.gain.linearRampToValueAtTime(0, ctx.currentTime + i * 0.2 + 0.4);
      osc.start(ctx.currentTime + i * 0.2);
      osc.stop(ctx.currentTime + i * 0.2 + 0.5);
    });
  } catch(e) {}
}

function handleMain() {
  if (isBreak && !isRunning && remainingSeconds === 0) {
    // Start break
    startBreak();
    return;
  }
  if (!isRunning) {
    startTimer();
  } else {
    pauseTimer();
  }
}

function startTimer() {
  isRunning = true;
  mainBtn.textContent = 'Pause';
  timerDisplay.classList.add('pulsing');
  durationSection.style.opacity = '0.4';
  durationSection.style.pointerEvents = 'none';
  tipBox.classList.remove('visible');

  interval = setInterval(() => {
    remainingSeconds--;
    updateDisplay();
    updateRing(remainingSeconds / totalSeconds);

    if (remainingSeconds <= 0) {
      clearInterval(interval);
      isRunning = false;
      timerDisplay.classList.remove('pulsing');
      ring.classList.add('ring-done');
      setTimeout(() => ring.classList.remove('ring-done'), 2000);
      playDone();
      onTimerDone();
    }
  }, 1000);
}

function pauseTimer() {
  clearInterval(interval);
  isRunning = false;
  mainBtn.textContent = 'Fortsett';
  timerDisplay.classList.remove('pulsing');
}

function handleReset() {
  clearInterval(interval);
  isRunning = false;
  isBreak = false;
  remainingSeconds = selectedDuration * 60;
  totalSeconds = remainingSeconds;
  updateDisplay();
  updateRing(1);
  mainBtn.textContent = 'Start';
  mainBtn.className = 'btn-primary';
  modeBadge.textContent = 'Fokus';
  modeBadge.className = 'mode-badge';
  ring.className = 'ring-progress';
  timerDisplay.classList.remove('pulsing');
  durationSection.style.opacity = '';
  durationSection.style.pointerEvents = '';
  tipBox.classList.remove('visible');
  timeLabel.textContent = 'minutter igjen';
}

function onTimerDone() {
  if (!isBreak) {
    // Focus done ‚Üí offer break
    modeBadge.textContent = 'Ferdig!';
    mainBtn.textContent = 'Ta 5 min pause';
    mainBtn.className = 'btn-primary break-btn';
    timeLabel.textContent = 'bra jobba! üéâ';

    tipTextEl.textContent = TIPS[tipIndex % TIPS.length];
    tipIndex++;
    tipBox.classList.add('visible');
    isBreak = true;
    durationSection.style.opacity = '0.4';
    durationSection.style.pointerEvents = 'none';
  } else {
    // Break done
    isBreak = false;
    modeBadge.textContent = 'Fokus';
    modeBadge.className = 'mode-badge';
    ring.className = 'ring-progress';
    mainBtn.textContent = 'Start ny √∏kt';
    mainBtn.className = 'btn-primary';
    remainingSeconds = selectedDuration * 60;
    totalSeconds = remainingSeconds;
    updateDisplay();
    updateRing(1);
    timeLabel.textContent = 'klar til ny runde!';
    durationSection.style.opacity = '';
    durationSection.style.pointerEvents = '';
    tipBox.classList.remove('visible');
  }
}

function startBreak() {
  isBreak = true;
  remainingSeconds = BREAK_DURATION * 60;
  totalSeconds = remainingSeconds;
  updateDisplay();
  updateRing(1);
  modeBadge.textContent = 'Pause';
  modeBadge.className = 'mode-badge break-mode';
  ring.className = 'ring-progress break-ring';
  mainBtn.textContent = 'Pause';
  mainBtn.className = 'btn-primary break-btn';
  timeLabel.textContent = 'minutter pause';
  tipBox.classList.remove('visible');
  startTimer();
}

updateDisplay();
updateRing(1);
</script>
</body>
</html>
